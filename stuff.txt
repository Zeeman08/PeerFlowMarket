CREATE TABLE COUNTRY (
  COUNTRY_ID TEXT PRIMARY KEY,
  COUNTRY_NAME TEXT NOT NULL
);

CREATE TABLE LOCATION (
  LOCATION_ID TEXT PRIMARY KEY,
  LOCATION_NAME TEXT NOT NULL,
  POST_CODE INTEGER NOT NULL,
  COUNTRY_ID TEXT,
	CONSTRAINT FK_LOCATION_COUNTRY_ID
    FOREIGN KEY (COUNTRY_ID)
      REFERENCES COUNTRY(COUNTRY_ID)
        ON DELETE CASCADE
);

CREATE TABLE TRANSACTIONS (
  TRANSACTION_ID SERIAL PRIMARY KEY,
  TRANSACTION_TIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE CART (
  CART_ID SERIAL PRIMARY KEY,
  PERSON_ID SERIAL,
  TOTAL_PRICE INTEGER DEFAULT 0,
  CONSTRAINT OWNER
    FOREIGN KEY (PERSON_ID)
      REFERENCES PERSON(PERSON_ID)
        ON DELETE CASCADE
);

CREATE TABLE CARTCONTENT (
  CARTCONTENT_ID SERIAL PRIMARY KEY,
  CART_ID SERIAL,
  PRODUCT_ID SERIAL,
  CONSTRAINT PARENT
    FOREIGN KEY (CART_ID)
      REFERNCES CART(CART_ID),
  CONSTRAINT CONTAINS
    FOREIGN KEY (PRODUCT_ID)
      REFERENCES PRODUCT(PRODUCT_ID)
);

CREATE TABLE ORDERS (
  ORDER_ID SERIAL PRIMARY KEY,
  CART_ID SERIAL,
  ORDER_DATE DATE DEFAULT CURRENT_DATE,
  COMMENTS TEXT,
  CONSTRAINT PARENT
    FOREIGN KEY (CART_ID)
      REFERNCES CART(CART_ID)
);

CREATE TABLE PERSON (
  PERSON_ID SERIAL PRIMARY KEY,
  PERSON_NAME TEXT NOT NULL,
  PASSWORD TEXT NOT NULL,
  LOCATION_ID TEXT NOT NULL,
  DATE_OF_BIRTH DATE NOT NULL,
  PHONE TEXT UNIQUE NOT NULL,
  EMAIL TEXT UNIQUE NOT NULL,
  IMAGE TEXT
);

CREATE TABLE MANAGES (
  PERSON_ID SERIAL PRIMARY KEY REFERENCES PERSON(PERSON_ID),
  STOREFRONT_ID SERIAL PRIMARY KEY REFERENCES STOREFRONT(STOREFRONT_ID)
	
);

CREATE TABLE STOREFRONT (
  STOREFRONT_ID SERIAL PRIMARY KEY,
  STOREFRONT_NAME TEXT NOT NULL,
  STOREFRONT_DESCRIPTION TEXT,
  RATING REAL DEFAULT 0,
  LAST_UPDATED_ON TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  IMAGE TEXT,
  CHECK (RATING >= 0 AND RATING <= 5)
);

CREATE INDEX Key_storefront ON STOREFRONT (RATING, LAST_UPDATED_ON);

CREATE TABLE PRODUCT (
  PRODUCT_ID SERIAL PRIMARY KEY,
  PRODUCT_NAME TEXT NOT NULL,
  PRODUCT_DESCRIPTION TEXT NOT NULL,
  PRICE REAL NOT NULL,
  IMAGE TEXT,
  RATING_SUM REAL DEFAULT 0,
  RATING_COUNT INTEGER DEFAULT 0,
  STOREFRONT_ID SERIAL,
  TAGS TEXT,
  CONSTRAINT FK_PRODUCT_STOREFRONT_ID
    FOREIGN KEY (STOREFRONT_ID)
      REFERENCES STOREFRONT(STOREFRONT_ID)
        ON DELETE CASCADE
);
CREATE INDEX Key_prodcut ON PRODUCT (PRODUCT_NAME, PRICE, IMAGE, TAGS);	

CREATE TABLE ANNOUNCEMENTS (
	ANNOUNCEMENT_ID SERIAL PRIMARY KEY,
	STOREFRONT_ID SERIAL,
	ANNOUNCEMENT_DESCRIPTION TEXT NOT NULL,
	POSTED_ON TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  IMAGE TEXT,
  CONSTRAINT FK_ANNOUNCEMENT_STOREFRONT_ID
    FOREIGN KEY (STOREFRONT_ID)
      REFERENCES STOREFRONT(STOREFRONT_ID)
        ON DELETE CASCADE
);
CREATE INDEX Key_announcement ON ANNOUNCEMENTS (POSTED_ON);	


INSERT INTO STOREFRONT (NAME, DESCRIPTION, RATING, LAST_UPDATED_ON, IMAGE)
VALUES
  ('name 1', 'Storefront 1', 4.5, '2024-01-08 12:30:00', 'image1.jpg'),
  ('name 2', 'Storefront 2', 3.8, '2024-01-09 15:45:00', 'image2.jpg'),
  ('name 3', 'Storefront 3', 5.0, '2024-01-10 09:00:00', 'image3.jpg');

INSERT INTO PRODUCT (PRODUCT_NAME, PRODUCT_DESCRIPTION, PRICE, IMAGE, STOREFRONT_ID, TAGS)
VALUES
  ('not GAMING PC', 'YOU CAN not PLAY GAMES ON IT', 100, 'IMAGE3.JPG', 1, '{"data": ["Apple", "Banana", "Orange"]}');

INSERT INTO PRODUCT (PRODUCT_NAME, PRODUCT_DESCRIPTION, PRICE, IMAGE,STOREFRONT_ID, TAGS)
VALUES
  ('GAMING PC', 'YOU CAN PLAY GAMES ON IT', 100, 'IMAGE3.JPG', 1, '{"data": ["Apple", "Banana", "Orange"]}');

INSERT INTO PRODUCT (PRODUCT_NAME, PRODUCT_DESCRIPTION, PRICE, IMAGE,STOREFRONT_ID, TAGS)
VALUES
  ('gaming phone', 'YOU CAN not PLAY GAMES ON IT', 100, 'IMAGE3.JPG', 2, '{"data": ["mango", "Banana", "Orange"]}');

INSERT INTO PRODUCT (PRODUCT_NAME, PRODUCT_DESCRIPTION, PRICE, IMAGE, STOREFRONT_ID, TAGS)
VALUES
  ('not a GAMING phone', 'YOU CAN PLAY GAMES ON IT', 100, 'IMAGE3.JPG', 2, '{"data": ["lichy", "Banana", "Orange"]}');

INSERT INTO PRODUCT (PRODUCT_NAME, PRODUCT_DESCRIPTION, PRICE, IMAGE, STOREFRONT_ID, TAGS)
VALUES
  ('gaming laptop', 'YOU CAN PLAY GAMES ON IT', 100, 'IMAGE3.JPG',  2, '{"data": ["jackfruit"]}');


INSERT INTO PRODUCT (PRODUCT_NAME, PRODUCT_DESCRIPTION, PRICE, IMAGE, STOREFRONT_ID, TAGS)
VALUES
  ('gaming chair', 'you can sit on it', 100, 'IMAGE3.JPG', 3, '{"data": ["sit", "play", "more fps"]}');

INSERT INTO PRODUCT (PRODUCT_NAME, PRODUCT_DESCRIPTION, PRICE, IMAGE,  STOREFRONT_ID, TAGS)
VALUES
  ('rgb lighting', 'more colors more fps', 100, 'IMAGE3.JPG', 3, '{"data": ["red", "green", "blue"]}');

  INSERT INTO announcements (STOREFRONT_ID,ANNOUNCEMENT_DESCRIPTION, POSTED_ON, IMAGE)
VALUES
  (1, 'WE ARE NOW OPEN','2024-01-08 12:30:00', 'IMAGE3.JPG');
  INSERT INTO announcements (STOREFRONT_ID,ANNOUNCEMENT_DESCRIPTION, POSTED_ON, IMAGE)
VALUES
  (1, 'WE ARE CLOSED FOR NOW','2024-01-08 12:40:00', 'IMAGE4.JPG');

INSERT INTO announcements (STOREFRONT_ID,ANNOUNCEMENT_DESCRIPTION, POSTED_ON, IMAGE)
VALUES
  (2, 'WE ARE NOW OPEN 2','2024-01-08 12:30:00', 'IMAGE3.JPG');
  
INSERT INTO announcements (STOREFRONT_ID,ANNOUNCEMENT_DESCRIPTION, POSTED_ON, IMAGE)
VALUES
  (2, 'WE ARE CLOSED FOR NOW 2','2024-01-08 12:40:00', 'IMAGE4.JPG');

INSERT INTO announcements (STOREFRONT_ID,ANNOUNCEMENT_DESCRIPTION, POSTED_ON, IMAGE)
VALUES
  (3, 'WE ARE NOW OPEN 3','2024-01-08 12:30:00', 'IMAGE3.JPG');
  
INSERT INTO announcements (STOREFRONT_ID,ANNOUNCEMENT_DESCRIPTION, POSTED_ON, IMAGE)
VALUES
  (3, 'WE ARE CLOSED FOR NOW 3','2024-01-08 12:40:00', 'IMAGE4.JPG');